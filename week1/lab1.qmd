---
title: "lab1"
format: html
---

1.  **Consider what data cleaning you might need to perform.** Discuss any curious data formatting (e.g. data types, inconsistent observation names, missing values, etc.) that you discovered during your data exploration step, above. What might you need to address in your next data wrangling steps?

    ```{r}
    library(tidyverse)
    library(fedmatch)
    library(janitor)
    stress <- read_csv(here::here("week1","data", "stressor.csv"))
    ```

<!-- -->

3.  **Clean / wrangle the data!** Using the packages loaded in step 1, perform the following operations (***NOTE:** Each step below corresponds to a single line of code*):

    a.  Remove all special characters in the `state` and `stressor` column observations

    <!-- -->

    a.  Convert all column names from CamelCase to snake_case (for ease of readability and to adhere to the [Tidyverse style guide](https://style.tidyverse.org/syntax.html#object-names) recommendation)

    b.  Check the class of the `year` variable. Update the data type if necessary.

    c.  Pivot your dataframe to make it tidy data. Remember, in tidy data:

        -   Each variables forms a column

        -   Each observation forms a row

        -   Each cell is a single measurement

    ```{r}
    stress_clean <- stress %>%  mutate(state = str_remove_all(state, pattern = "[^[:alpha:]]"), stressor = str_remove_all(stressor, pattern = "[^[:_alpha_:]]"), year = as.factor(year)) %>%  clean_names(case = "snake")  %>% pivot_longer(cols = january_march:october_december, names_to = "month_range", values_to = 'percent_colonies') %>% mutate(quarter = case_when(
      month_range ==  "january_march" ~ 1,
      month_range ==  "april_june" ~ 2,
      month_range ==  "july_september" ~ 3, 
      month_range ==  "october_december" ~ 4
    )) %>% filter(state != "UnitedStates" & state != "OtherStates")

    unique(stress_clean$stressor)

    stress_clean_tx <- stress_clean %>% filter(state == "Texas", stressor  == "Pesticides")

    stress_clean_tx %>% group_by(year, quarter) %>% summarize(mean_quarter = mean(percent_colonies, na.rm = T)) %>% ggplot(aes(x = quarter, y = mean_quarter, col = year)) + geom_line(group = 1)  + facet_wrap(~year)


    stress_clean_tx %>% group_by(year, quarter) %>% summarize(mean_quarter = mean(percent_colonies, na.rm = T)) %>% ggplot(aes(x = quarter, y = mean_quarter, col = year)) + geom_boxplot() 
    ```

    a.  Create a new column named `quarter` that contains the quarter number that the observation took place in

    b.  Remove any rows where the state is “United States” or “Other States”

    c.  Filter to select a single stressor and single state that interests you!

    d.  Group by year and quarter to calculate the average stress level

    e.  Create a data viz of your choice!
